{"ast":null,"code":"import _JSXStyle from \"styled-jsx/style\";\nvar __jsx = React.createElement;\nimport React, { useEffect, useState, useContext } from 'react';\nimport Axios from 'axios';\nimport UserContext from '../../context/AdminContext';\nimport { confirmAlert } from 'react-confirm-alert';\nimport { FaShareSquare } from 'react-icons/fa';\nimport TopNavbar from './topNavbar';\nimport Router from 'next/router';\nimport Cookies from 'js-cookie';\nimport AlertContext from '../../context/alert/alertContext';\nimport sendMail from '../genericFunctions/sendMail';\nimport getProfile from '../genericFunctions/getProfile';\nimport { NotificationContainer, NotificationManager } from 'react-notifications';\n\nconst dashboard = props => {\n  const context = useContext(UserContext);\n  const {\n    0: state,\n    1: setState\n  } = useState('');\n  const alertContext = useContext(AlertContext);\n  const {\n    setAlert,\n    alerts\n  } = alertContext;\n  const {\n    0: details,\n    1: setDetails\n  } = useState('');\n  const token = Cookies.get('adminToken');\n\n  const init = async () => {\n    if (token != undefined) {\n      try {\n        const data = await get_all_transactions(Cookies.get('adminToken'));\n        setState(data);\n      } catch (error) {\n        console.log(error);\n        setAlert('Algo salió mal', 'danger');\n        Router.push('/admin_login');\n      }\n    } else {\n      Router.push('/admin_login');\n    }\n  };\n\n  useEffect(() => {\n    init();\n  }, []);\n\n  const handleSubmit = (id, operation, status) => {\n    confirmAlert({\n      title: 'Confirmar para enviar',\n      message: '¿Estás seguro de que quieres hacer esto?',\n      buttons: [{\n        label: 'Si',\n        onClick: async () => {\n          await changeStatus(Cookies.get('adminToken'), id, operation.transaction.amountReceive, operation.transaction.amountToPay, operation.transaction.currencyTo, operation.transaction.currencyFrom, status);\n          const profile = await getProfile(token);\n          setDetails(profile);\n          await sendMail(token, operation.profileDetails.email, 'success', {\n            profileDetails: operation.profileDetails,\n            bankDetails: operation.bankDetails,\n            transaction: operation.transaction,\n            status\n          });\n          NotificationManager.info('Estado cambiado', 'Title here');\n          init();\n        }\n      }, {\n        label: 'No',\n        onClick: () => console.log('Haga clic en no')\n      }]\n    });\n  };\n\n  const handleRefresh = () => {\n    console.log('refresh called..');\n    init();\n  };\n\n  if (state === '') {\n    return __jsx(\"div\", null, \"loading...\");\n  }\n\n  return __jsx(React.Fragment, null, __jsx(TopNavbar, {\n    handleRefresh: handleRefresh\n  }), __jsx(\"div\", {\n    className: \"jsx-1313192870\" + \" \" + 'container w-100 mt-5'\n  }, __jsx(NotificationContainer, null), __jsx(\"div\", {\n    className: \"jsx-1313192870\" + \" \" + 'row ml-1 mb-5 mt-5 pt-5'\n  }, __jsx(\"div\", {\n    className: \"jsx-1313192870\" + \" \" + 'col-3'\n  }, __jsx(\"h4\", {\n    className: \"jsx-1313192870\"\n  }, \"Detalles del banco\")), __jsx(\"div\", {\n    className: \"jsx-1313192870\" + \" \" + 'col-3'\n  }, __jsx(\"h4\", {\n    className: \"jsx-1313192870\"\n  }, \"Detalles del perfil\")), __jsx(\"div\", {\n    className: \"jsx-1313192870\" + \" \" + 'col-4'\n  }, __jsx(\"h4\", {\n    className: \"jsx-1313192870\"\n  }, \"Detalles de operaci\\xF3n\")), __jsx(\"div\", {\n    className: \"jsx-1313192870\" + \" \" + 'col-2'\n  }, __jsx(\"h4\", {\n    className: \"jsx-1313192870\"\n  }, \"Estado de la operaci\\xF3n\"))), __jsx(\"hr\", {\n    className: \"jsx-1313192870\"\n  }), __jsx(\"h1\", {\n    className: \"jsx-1313192870\"\n  }, \"Candidad Recibida\"), state.filter(op => op.transaction.status === 'Cantidad recibida').map((operation, index) => {\n    return __jsx(React.Fragment, {\n      key: index\n    }, __jsx(\"div\", {\n      className: \"jsx-1313192870\" + \" \" + 'row'\n    }, __jsx(\"div\", {\n      className: \"jsx-1313192870\" + \" \" + 'col-3'\n    }, __jsx(\"div\", {\n      className: \"jsx-1313192870\" + \" \" + 'row'\n    }, __jsx(\"div\", {\n      className: \"jsx-1313192870\" + \" \" + 'col-12'\n    }, __jsx(\"strong\", {\n      className: \"jsx-1313192870\"\n    }, \"N\\xFAmero de cuenta:\"), operation.bankDetails.accountNumber), __jsx(\"div\", {\n      className: \"jsx-1313192870\" + \" \" + 'col-12'\n    }, __jsx(\"strong\", {\n      className: \"jsx-1313192870\"\n    }, \"Nombre del banco:\"), operation.bankDetails.bankName), __jsx(\"div\", {\n      className: \"jsx-1313192870\" + \" \" + 'col-12'\n    }, __jsx(\"strong\", {\n      className: \"jsx-1313192870\"\n    }, \"Due\\xF1o de cuenta:\"), operation.bankDetails.nickname || ''))), __jsx(\"div\", {\n      className: \"jsx-1313192870\" + \" \" + 'col-4'\n    }, __jsx(\"div\", {\n      className: \"jsx-1313192870\" + \" \" + 'row'\n    }, __jsx(\"div\", {\n      className: \"jsx-1313192870\" + \" \" + 'col-12'\n    }, __jsx(\"strong\", {\n      className: \"jsx-1313192870\"\n    }, \"Nombre: \"), operation.profileDetails.firstName), __jsx(\"div\", {\n      className: \"jsx-1313192870\" + \" \" + 'col-12'\n    }, __jsx(\"strong\", {\n      className: \"jsx-1313192870\"\n    }, \"E-mail:\"), ' ', operation.profileDetails.email))), __jsx(\"div\", {\n      className: \"jsx-1313192870\" + \" \" + 'col-3'\n    }, __jsx(\"div\", {\n      className: \"jsx-1313192870\" + \" \" + 'row'\n    }, __jsx(\"div\", {\n      className: \"jsx-1313192870\" + \" \" + 'col-12'\n    }, __jsx(\"strong\", {\n      className: \"jsx-1313192870\"\n    }, \"Monto a pagar:\"), operation.transaction.amountToPay, operation.transaction.currencyTo), __jsx(\"div\", {\n      className: \"jsx-1313192870\" + \" \" + 'col-12'\n    }, __jsx(\"strong\", {\n      className: \"jsx-1313192870\"\n    }, \"Cantidad recibida:\"), operation.transaction.amountReceive, operation.transaction.currencyFrom))), __jsx(\"div\", {\n      className: \"jsx-1313192870\" + \" \" + 'col-1'\n    }, __jsx(\"strong\", {\n      className: \"jsx-1313192870\"\n    }, operation.transaction.status)), __jsx(\"div\", {\n      className: \"jsx-1313192870\" + \" \" + 'col-1'\n    }, __jsx(\"button\", {\n      onClick: () => handleSubmit(operation._id, operation, // operation.profileDetails.email,\n      // operation.transaction.amountReceive,\n      // operation.transaction.amountToPay,\n      // operation.transaction.currencyTo,\n      // operation.transaction.currencyFrom,\n      'Completo'),\n      className: \"jsx-1313192870\" + \" \" + 'btn btn-dark'\n    }, \"Cambiar Estado\"))), __jsx(\"hr\", {\n      className: \"jsx-1313192870\"\n    }));\n  }), __jsx(\"h1\", {\n    className: \"jsx-1313192870\"\n  }, \"Pago Pendiente\"), state.filter(op => op.transaction.status === 'Pago pendiente').map((operation, index) => {\n    return __jsx(React.Fragment, {\n      key: index\n    }, __jsx(\"div\", {\n      className: \"jsx-1313192870\" + \" \" + 'row'\n    }, __jsx(\"div\", {\n      className: \"jsx-1313192870\" + \" \" + 'col-3'\n    }, __jsx(\"div\", {\n      className: \"jsx-1313192870\" + \" \" + 'row'\n    }, __jsx(\"div\", {\n      className: \"jsx-1313192870\" + \" \" + 'col-12'\n    }, __jsx(\"strong\", {\n      className: \"jsx-1313192870\"\n    }, \"N\\xFAmero de cuenta:\"), operation.bankDetails.accountNumber), __jsx(\"div\", {\n      className: \"jsx-1313192870\" + \" \" + 'col-12'\n    }, __jsx(\"strong\", {\n      className: \"jsx-1313192870\"\n    }, \"Nombre del banco:\"), operation.bankDetails.bankName), __jsx(\"div\", {\n      className: \"jsx-1313192870\" + \" \" + 'col-12'\n    }, __jsx(\"strong\", {\n      className: \"jsx-1313192870\"\n    }, \"Due\\xF1o de cuenta:\"), operation.bankDetails.nickname || ''))), __jsx(\"div\", {\n      className: \"jsx-1313192870\" + \" \" + 'col-4'\n    }, __jsx(\"div\", {\n      className: \"jsx-1313192870\" + \" \" + 'row'\n    }, __jsx(\"div\", {\n      className: \"jsx-1313192870\" + \" \" + 'col-12'\n    }, __jsx(\"strong\", {\n      className: \"jsx-1313192870\"\n    }, \"Nombre: \"), operation.profileDetails.firstName), __jsx(\"div\", {\n      className: \"jsx-1313192870\" + \" \" + 'col-12'\n    }, __jsx(\"strong\", {\n      className: \"jsx-1313192870\"\n    }, \"E-mail:\"), ' ', operation.profileDetails.email))), __jsx(\"div\", {\n      className: \"jsx-1313192870\" + \" \" + 'col-3'\n    }, __jsx(\"div\", {\n      className: \"jsx-1313192870\" + \" \" + 'row'\n    }, __jsx(\"div\", {\n      className: \"jsx-1313192870\" + \" \" + 'col-12'\n    }, __jsx(\"strong\", {\n      className: \"jsx-1313192870\"\n    }, \"Monto a pagar:\"), operation.transaction.amountToPay, operation.transaction.currencyTo), __jsx(\"div\", {\n      className: \"jsx-1313192870\" + \" \" + 'col-12'\n    }, __jsx(\"strong\", {\n      className: \"jsx-1313192870\"\n    }, \"Cantidad recibida:\"), operation.transaction.amountReceive, operation.transaction.currencyFrom))), __jsx(\"div\", {\n      className: \"jsx-1313192870\" + \" \" + 'col-1'\n    }, __jsx(\"strong\", {\n      className: \"jsx-1313192870\"\n    }, operation.transaction.status)), __jsx(\"div\", {\n      className: \"jsx-1313192870\" + \" \" + 'col-1'\n    }, __jsx(\"button\", {\n      onClick: () => handleSubmit(operation._id, operation, // operation.profileDetails.email,\n      // operation.transaction.amountReceive,\n      // operation.transaction.amountToPay,\n      // operation.transaction.currencyTo,\n      // operation.transaction.currencyFrom,\n      'Completo'),\n      className: \"jsx-1313192870\" + \" \" + 'btn btn-dark'\n    }, \"Cambiar Estado\"))), __jsx(\"hr\", {\n      className: \"jsx-1313192870\"\n    }));\n  }), __jsx(\"h1\", {\n    className: \"jsx-1313192870\"\n  }, \"Completo\"), state.filter(op => op.transaction.status === 'Completo').map((operation, index) => {\n    return __jsx(React.Fragment, {\n      key: index\n    }, __jsx(\"div\", {\n      className: \"jsx-1313192870\" + \" \" + 'row'\n    }, __jsx(\"div\", {\n      className: \"jsx-1313192870\" + \" \" + 'col-3'\n    }, __jsx(\"div\", {\n      className: \"jsx-1313192870\" + \" \" + 'row'\n    }, __jsx(\"div\", {\n      className: \"jsx-1313192870\" + \" \" + 'col-12'\n    }, __jsx(\"strong\", {\n      className: \"jsx-1313192870\"\n    }, \"N\\xFAmero de cuenta:\"), operation.bankDetails.accountNumber), __jsx(\"div\", {\n      className: \"jsx-1313192870\" + \" \" + 'col-12'\n    }, __jsx(\"strong\", {\n      className: \"jsx-1313192870\"\n    }, \"Nombre del banco:\"), operation.bankDetails.bankName), __jsx(\"div\", {\n      className: \"jsx-1313192870\" + \" \" + 'col-12'\n    }, __jsx(\"strong\", {\n      className: \"jsx-1313192870\"\n    }, \"Due\\xF1o de cuenta:\"), operation.bankDetails.nickname || ''))), __jsx(\"div\", {\n      className: \"jsx-1313192870\" + \" \" + 'col-4'\n    }, __jsx(\"div\", {\n      className: \"jsx-1313192870\" + \" \" + 'row'\n    }, __jsx(\"div\", {\n      className: \"jsx-1313192870\" + \" \" + 'col-12'\n    }, __jsx(\"strong\", {\n      className: \"jsx-1313192870\"\n    }, \"Nombre: \"), operation.profileDetails.firstName), __jsx(\"div\", {\n      className: \"jsx-1313192870\" + \" \" + 'col-12'\n    }, __jsx(\"strong\", {\n      className: \"jsx-1313192870\"\n    }, \"E-mail:\"), ' ', operation.profileDetails.email))), __jsx(\"div\", {\n      className: \"jsx-1313192870\" + \" \" + 'col-3'\n    }, __jsx(\"div\", {\n      className: \"jsx-1313192870\" + \" \" + 'row'\n    }, __jsx(\"div\", {\n      className: \"jsx-1313192870\" + \" \" + 'col-12'\n    }, __jsx(\"strong\", {\n      className: \"jsx-1313192870\"\n    }, \"Monto a pagar:\"), operation.transaction.amountToPay, operation.transaction.currencyTo), __jsx(\"div\", {\n      className: \"jsx-1313192870\" + \" \" + 'col-12'\n    }, __jsx(\"strong\", {\n      className: \"jsx-1313192870\"\n    }, \"Cantidad recibida:\"), operation.transaction.amountReceive, operation.transaction.currencyFrom))), __jsx(\"div\", {\n      className: \"jsx-1313192870\" + \" \" + 'col-1'\n    }, __jsx(\"strong\", {\n      className: \"jsx-1313192870\"\n    }, operation.transaction.status)), __jsx(\"div\", {\n      className: \"jsx-1313192870\" + \" \" + 'col-1'\n    }, __jsx(\"button\", {\n      onClick: () => handleSubmit(operation._id, operation, // operation.profileDetails.email,\n      // operation.transaction.amountReceive,\n      // operation.transaction.amountToPay,\n      // operation.transaction.currencyTo,\n      // operation.transaction.currencyFrom,\n      'Completo'),\n      className: \"jsx-1313192870\" + \" \" + 'btn btn-dark'\n    }, \"Cambiar Estado\"))), __jsx(\"hr\", {\n      className: \"jsx-1313192870\"\n    }));\n  }), __jsx(_JSXStyle, {\n    id: \"1313192870\"\n  }, [\".point.jsx-1313192870{cursor:context-menu;}\", \".btn.jsx-1313192870:hover{-webkit-transition:0.3s;transition:0.3s;}\"])));\n};\n\nexport default dashboard;\n\nconst changeStatus = async (token, id, amountReceive, amountToPay, currencyTo, currencyFrom, status) => {\n  const body = {\n    transaction: {\n      amountReceive,\n      amountToPay,\n      currencyTo,\n      currencyFrom,\n      status\n    }\n  };\n  const header = {\n    headers: {\n      'x-auth-token': token\n    }\n  };\n  const res = await Axios.put('https://api.moni.pe/api/operations/' + id, body, header);\n  return res.data;\n};\n\nconst get_all_transactions = async token => {\n  const body = {};\n  const header = {\n    headers: {\n      'x-auth-token': token\n    }\n  };\n  const res = await Axios.get('https://api.moni.pe/api/operations', header);\n  return res.data;\n};\n\nconst notification = () => {\n  const publicVapidKey = 'BBzxUnsSFfJls1TkK3_3EPsOrN3iI05ZjUvB8fc03Vezvh2Bo39c3oV-sT0_x-bYCEgPAMgvbeLqrDgHTxYsCAA'; // Check for service worker\n\n  if ('serviceWorker' in navigator) {\n    send().catch(err => console.error(err));\n  } // Register SW, Register Push, Send Push\n\n\n  async function send() {\n    // Register Service Worker\n    console.log('Registering service worker...');\n    const register = await navigator.serviceWorker.register('/sw.js', {\n      scope: '/'\n    });\n    console.log('Service Worker Registered...'); // Register Push\n\n    console.log('Registering Push...');\n    const subscription = await register.pushManager.subscribe({\n      userVisibleOnly: true,\n      applicationServerKey: urlBase64ToUint8Array(publicVapidKey)\n    });\n    console.log('Push Registered...', subscription); // Send Push Notification\n\n    console.log('Sending Push...');\n    await fetch('http://localhost:5000/api/notifications/subscribe', {\n      method: 'POST',\n      body: JSON.stringify(subscription),\n      headers: {\n        'content-type': 'application/json'\n      }\n    });\n    console.log('Push Sent...');\n  }\n\n  function urlBase64ToUint8Array(base64String) {\n    const padding = '='.repeat((4 - base64String.length % 4) % 4);\n    const base64 = (base64String + padding).replace(/\\-/g, '+').replace(/_/g, '/');\n    const rawData = window.atob(base64);\n    const outputArray = new Uint8Array(rawData.length);\n\n    for (let i = 0; i < rawData.length; ++i) {\n      outputArray[i] = rawData.charCodeAt(i);\n    }\n\n    return outputArray;\n  }\n};","map":null,"metadata":{},"sourceType":"module"}