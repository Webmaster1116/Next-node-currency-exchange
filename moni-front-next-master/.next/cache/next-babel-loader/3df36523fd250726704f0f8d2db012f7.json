{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _JSXStyle from \"styled-jsx/style\";\nvar __jsx = React.createElement;\nimport React, { useState, useContext, useEffect } from 'react';\nimport { Table } from 'react-bootstrap';\nimport Axios from 'axios';\nimport AdminContext from '../../context/AdminContext';\nimport Layout from '../../components/Admin/Layout';\nimport Router, { withRouter } from 'next/router';\nimport AlertContext from '../../context/alert/alertContext';\nimport getAgents from '../../components/genericFunctions/getAvailAgent';\nimport Link from 'next/link';\nimport Head from 'next/head';\nimport Cookies from 'js-cookie';\nimport Navbar from '../../components/Admin/topNavbar';\nimport ViewBankPopup from '../../components/Admin/viewBankPopup';\nimport moment from 'moment';\nimport getAgentAccounts from '../../components/genericFunctions/getAgentAccounts';\nimport ViewAgentPopup from '../../components/Agents/viewAgentPopup';\nimport EditAgentPopup from '../../components/Agents/editAgentPopup';\n\nvar agentRegister = function agentRegister(props) {\n  var _useState = useState([]),\n      state = _useState[0],\n      setState = _useState[1]; //   const { state, addToken, changeAuthenticated } = useContext(AdminContext);\n\n\n  var alertContext = useContext(AlertContext);\n  var setAlert = alertContext.setAlert,\n      alerts = alertContext.alerts;\n\n  var _useState2 = useState(false),\n      awaitData = _useState2[0],\n      setAwaitData = _useState2[1];\n\n  var _useState3 = useState(false),\n      showPassword = _useState3[0],\n      setShowPassword = _useState3[1];\n\n  var _useState4 = useState(false),\n      viewBankModal = _useState4[0],\n      setViewBankModal = _useState4[1];\n\n  var _useState5 = useState(''),\n      popupBankData = _useState5[0],\n      setPopupBankData = _useState5[1];\n\n  var _useState6 = useState(''),\n      selectedAgentId = _useState6[0],\n      setSelectedAgentId = _useState6[1];\n\n  var _useState7 = useState(false),\n      viewAgentPopup = _useState7[0],\n      setViewAgentPopup = _useState7[1];\n\n  var _useState8 = useState(false),\n      editAgentPopup = _useState8[0],\n      setEditAgentPopup = _useState8[1];\n\n  var _useState9 = useState(''),\n      selectedAgent = _useState9[0],\n      setSelectedAgent = _useState9[1];\n\n  var token = Cookies.get('adminToken');\n\n  var init = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var coo, data;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              coo = Cookies.get('adminToken');\n\n              if (!(coo !== undefined)) {\n                _context.next = 9;\n                break;\n              }\n\n              _context.next = 4;\n              return getAgents(token);\n\n            case 4:\n              data = _context.sent;\n              setState(data);\n              console.log(data, 'agents');\n              _context.next = 11;\n              break;\n\n            case 9:\n              window.location.href = '/admin_login';\n              setAlert('Admin Login First', 'danger');\n\n            case 11:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function init() {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  useEffect(function () {\n    init();\n  }, []);\n\n  var handleEnable = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(e, id, prevStatus) {\n      var newStatus, header, res;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              newStatus = !prevStatus ? 'enable' : 'disable';\n              e.preventDefault();\n              console.log('enable called');\n              header = {\n                headers: {\n                  'x-auth-token': token\n                }\n              };\n              _context2.next = 6;\n              return Axios.get('https://api.moni.pe/api/agent/' + newStatus + '/' + id, header);\n\n            case 6:\n              res = _context2.sent;\n              console.log(res);\n              _context2.next = 10;\n              return init();\n\n            case 10:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function handleEnable(_x, _x2, _x3) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  return __jsx(React.Fragment, null, __jsx(Layout, null, __jsx(Navbar, null), __jsx(\"section\", {\n    className: \"jsx-2650147279\" + \" \" + 'page-section min-section pt-30 mt-40'\n  }, editAgentPopup ? __jsx(EditAgentPopup, {\n    setEditAgentPopup: setEditAgentPopup,\n    agent: selectedAgent,\n    token: true,\n    id: selectedAgentId\n  }) : '', __jsx(\"div\", {\n    className: \"jsx-2650147279\" + \" \" + 'container min-section'\n  }, __jsx(\"div\", {\n    className: \"jsx-2650147279\" + \" \" + 'row mt-10 mb-30'\n  }), __jsx(\"div\", {\n    className: \"jsx-2650147279\" + \" \" + 'row'\n  }, __jsx(\"div\", {\n    className: \"jsx-2650147279\" + \" \" + 'col-md-12'\n  }, __jsx(Table, {\n    responsive: \"sm\",\n    className: \"table table-striped\"\n  }, __jsx(\"tbody\", {\n    className: \"jsx-2650147279\"\n  }, __jsx(\"tr\", {\n    className: \"jsx-2650147279\"\n  }, __jsx(\"th\", {\n    className: \"jsx-2650147279\" + \" \" + 'hidden-xs'\n  }), __jsx(\"th\", {\n    className: \"jsx-2650147279\"\n  }, \"Nombre \"), __jsx(\"th\", {\n    className: \"jsx-2650147279\"\n  }, \"E-mail\"), __jsx(\"th\", {\n    className: \"jsx-2650147279\"\n  }, \"Soles de comisi\\xF3n\"), __jsx(\"th\", {\n    className: \"jsx-2650147279\"\n  }, \"D\\xF3lares de comisi\\xF3n\"), __jsx(\"th\", {\n    className: \"jsx-2650147279\"\n  }, \"N\\xFAmero de \", __jsx(\"br\", {\n    className: \"jsx-2650147279\"\n  }), \" operaciones\"), __jsx(\"th\", {\n    className: \"jsx-2650147279\"\n  }, \"Estado\"), __jsx(\"th\", {\n    className: \"jsx-2650147279\"\n  }, \"Acci\\xF3n\")), state.map(function (agent, index) {\n    return __jsx(React.Fragment, {\n      key: index\n    }, viewBankModal ? __jsx(ViewBankPopup, {\n      setAvailBalanceOn: setViewBankModal,\n      data: agent,\n      token: token,\n      id: selectedAgentId\n    }) : '', viewAgentPopup ? __jsx(ViewAgentPopup, {\n      setViewAgentPopup: setViewAgentPopup,\n      agent: selectedAgent,\n      token: true,\n      id: selectedAgentId\n    }) : '', __jsx(\"tr\", {\n      className: \"jsx-2650147279\"\n    }, __jsx(\"td\", {\n      className: \"jsx-2650147279\" + \" \" + 'hidden-xs'\n    }, __jsx(\"input\", {\n      type: \"checkbox\",\n      checked: agent.enable,\n      onChange: function onChange(e) {\n        return handleEnable(e, agent._id, agent.enable);\n      },\n      className: \"jsx-2650147279\" + \" \" + 'form-check-input'\n    })), __jsx(\"td\", {\n      className: \"jsx-2650147279\"\n    }, __jsx(\"button\", {\n      onClick: /*#__PURE__*/function () {\n        var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(e) {\n          return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n            while (1) {\n              switch (_context3.prev = _context3.next) {\n                case 0:\n                  e.preventDefault(); // const res = await getAgentAccounts(\n                  //   token,\n                  //   agent._id\n                  // );\n                  // setPopupBankData(res);\n\n                  setSelectedAgentId(agent._id);\n                  setViewBankModal(!viewBankModal);\n\n                case 3:\n                case \"end\":\n                  return _context3.stop();\n              }\n            }\n          }, _callee3);\n        }));\n\n        return function (_x4) {\n          return _ref3.apply(this, arguments);\n        };\n      }(),\n      className: \"jsx-2650147279\" + \" \" + 'btn orange'\n    }, agent.name || '', ' ')), __jsx(\"td\", {\n      className: \"jsx-2650147279\"\n    }, agent.email || '', \" \"), __jsx(\"td\", {\n      className: \"jsx-2650147279\"\n    }, parseFloat(agent.commissionDollars).toFixed(4) || '0', ' ', ' $', ' '), __jsx(\"td\", {\n      className: \"jsx-2650147279\"\n    }, parseFloat(agent.commissionSoles).toFixed(4) || '0', ' S./'), __jsx(\"td\", {\n      className: \"jsx-2650147279\"\n    }, agent.length || '', \" \"), __jsx(\"td\", {\n      className: \"jsx-2650147279\"\n    }, agent.online ? 'En l√≠nea' : 'Desconectado'), __jsx(\"td\", {\n      className: \"jsx-2650147279\"\n    }, __jsx(\"table\", {\n      className: \"jsx-2650147279\"\n    }, __jsx(\"tr\", {\n      className: \"jsx-2650147279\"\n    }, __jsx(\"td\", {\n      className: \"jsx-2650147279\" + \" \" + 'pr'\n    }, __jsx(\"button\", {\n      onClick: function onClick() {\n        setSelectedAgent(agent);\n        setViewAgentPopup(!viewAgentPopup);\n        setEditAgentPopup(false);\n      },\n      className: \"jsx-2650147279\" + \" \" + 'btn'\n    }, __jsx(\"i\", {\n      className: \"jsx-2650147279\" + \" \" + 'fa fa-lg  fa-eye'\n    }))), __jsx(\"td\", {\n      className: \"jsx-2650147279\" + \" \" + 'pr'\n    }, __jsx(\"button\", {\n      onClick: function onClick() {\n        setSelectedAgent(agent);\n        setEditAgentPopup(!editAgentPopup);\n        setViewAgentPopup(false);\n      },\n      className: \"jsx-2650147279\" + \" \" + 'btn'\n    }, __jsx(\"i\", {\n      className: \"jsx-2650147279\" + \" \" + 'fa fa-lg  fa-edit'\n    }))))))));\n  })))))), __jsx(_JSXStyle, {\n    id: \"2650147279\"\n  }, [\".min-section.jsx-2650147279{background:white;background-image:url('../images/bkg-neutro.jpg') !important;background-attachment:fixed;background-repeat:no-repeat;background-size:cover;}\", \".btn.jsx-2650147279{background:white;margin:0px;padding:0px;}\", \".min-section.jsx-2650147279{max-height:900vh;min-height:80vh;overflow:auto;white-space:nowrap;}\", \".page-section.jsx-2650147279{max-height:100vh;}\"]))));\n};\n\nexport default agentRegister;","map":null,"metadata":{},"sourceType":"module"}